# 可解释新指标

## SHAP-General 指标

### 两个样本之间的 SHAP 可解释距离

其中 $F$ 是特征集合

$$
D(x_i, x_j, F) =
\sum_{f\in F}^f
|\phi_i^f-\phi_j^f|
$$

该指标表示两个样本的相似程度

该指标不用考虑样本标签，因为本身已经含有样本标签的信息

### 样本与总体的 SHAP 可解释距离

$$
D(x_i, X, F) =
\frac 1{m-1}
\sum_{x_j \in X\backslash x_i}^j
\sum_{f\in F}^f
|\phi_i^f-\phi_j^f|
$$

$m$ 表示 样本总数

也可以写作

$$
D(x_i, X, F) =
\frac 1{m-1}
\sum_{x_j \in X\backslash x_i}^{x_j}
D(x_i, x_j)
$$

## SHAP-Fairness 指标

### 两个样本之间的 SHAP 可解释距离（在敏感属性上）

Shapley Distance between Individual and Individual

SDII

其中 $A$ 是敏感属性集合

$$
D(x_i, x_j, A) =
\sum_{f\in A}^f
|\phi_i^f-\phi_j^f|
$$

### 样本在群体之间的可解释距离

Shapley Distance between Individual and Group

SDIG

$$
a = x_i^A \\
X^a  = \{x | x \in X \cap x^A \equiv a \} \\
m = {\rm count}(X^a) \\
D(x_i, X^a, A) = \frac 1{m-1} \sum_{x_j \in X^a \backslash x_i}^{x_j} D(x_i, x_j, A)
$$

该值表示 样本与其群体的差值，该指标越大，说明样本与群体的差异越大，说明越不公平

### 歧视样本发现

定义阈值 $t$， 对于每个样本，找到其与群体之间的 DIGSV ，如果大于阈值，则标记为不公平样本

因为敏感属性中也包含部分信息，所以不能单纯地让敏感属性的 Shapley Value 朝着 0 的方法去优化

首先是「样本发现算法」，基于 SHAP 框架计算的 Shapley value，可以直观地看到每个特征的贡献，我们认为，敏感属性相同的为同一个群体，比如男性或者女性，或者 白男，非白男，白女，非白女之类的划分

那么群体内部，敏感属性的贡献应该相似，所以定义了 SDII 和 SDIG，用来发现歧视样本

### 歧视样本消除

将样本分为 「可解释公平样本」 和 「可解释不公平样本」

对于每个「可解释不公平样本」，使用 knn 算法在「可解释公平样本」寻找 k 个公平样本

并根据这 k 个公平样本得到新的标签值，更改可解释不公平样本的标签

根据相似的样本应该得到相同的结果，但是要剔除刚刚发现的不公平的样本

### 评价指标

- 样本数
- 准确率
- 精确率
- 召回率
- FPR
- FNR
- F1 Score
- ROCAUC 的面积
- 人口平等 差异
- 人口平等 比率
- 机会均等 差异
- 机会均等 比率
